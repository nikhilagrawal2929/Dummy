import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RestController;
import java.util.List;
import java.util.Map;

@RestController
public class CSVController {

    private static final Logger LOGGER = LoggerFactory.getLogger(CSVController.class);

    private final CSVReaderService csvReaderService;
    private final XMLGenerator xmlGenerator;

    public CSVController(CSVReaderService csvReaderService, XMLGenerator xmlGenerator) {
        this.csvReaderService = csvReaderService;
        this.xmlGenerator = xmlGenerator;
    }

    @GetMapping("/generate-xml")
    public String generateXMLResponse() {
        LOGGER.info("Received request to generate XML.");
        String[] fileNames = {"file1.csv", "file2.csv", "file3.csv"}; // Replace with your file names
        Map<String, CSVData> csvDataMap = csvReaderService.readMultipleCSVs(fileNames);
        StringBuilder xmlResponseBuilder = new StringBuilder();
        for (Map.Entry<String, CSVData> entry : csvDataMap.entrySet()) {
            String fileName = entry.getKey();
            CSVData csvData = entry.getValue();
            String[] headers = csvData.getHeaders();
            List<String[]> csvRecords = csvData.getData();
            String xmlResponse = xmlGenerator.generateXML(csvRecords, headers);
            xmlResponseBuilder.append("File: ").append(fileName).append("\n");
            xmlResponseBuilder.append(xmlResponse).append("\n\n");
        }
        LOGGER.info("XML response generated successfully.");
        return xmlResponseBuilder.toString();
    }
}
